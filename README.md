# Установка OpenMC + Jupyter с помощью Docker
## 1. Установите Docker desktop
1.1 Скачайте установщик для вашей операционной системы и архитектуры процессора с официального сайта: https://docs.docker.com/desktop/
(скорее всего, это Windows и AMD64). 

1.2 Запустите установщик, соглашайтесь со всем, что он попросит. После установки потребуется перезапуск.

1.3 При первом запуске на Windows может потребоваться обновление WSL, о чём уведомит приложение. Оно попросит ввести команду `wsl --update` (или что-то такое). Для запуска командной строки нажмите `Win + R` и введите `cmd` в появившемся окошке. Также можете воспользоваться меню приложений. После обновления WSL нужно перезапустить Docker (синюю кнопку, которая это сделает приложение вам тоже выведет). Перезапуск системы не требуется

1.4 Поздравляем, вы запустили Docker!

## 2. Запуск Jupyter Lab
2.1 Создайте новую директорию (папку). Для примера назовём её `openmc`. Расположение не имеет значения. В этой директории создайте новый файл с названием `Dockerfile` и ещё одну директорию (например, `jupyter`).

2.2 Откройте `Dockerfile` любым блокнотом и вставьте туда следующее:
```
FROM openmc/openmc:latest
RUN pip install jupyterlab
EXPOSE 8888
RUN mkdir /home/jupyter
WORKDIR /home/jupyter
CMD jupyter lab --port=8888 --no-browser --ip=0.0.0.0 --allow-root
```

2.3 Откройте приложение Docker desktop. В нижнем правом углу найдите кнопку терминала и активируйте его. Она может называться `Terminal` или выглдеть как значок `>_`. С помощью команды `cd "<путь_к_директории>/openmc"` перейдите в директорию с `Dockerfile`.
На Windows может потребоваться сменить диск командой `D:`. При возникновении ошибок используйте `\` вместо `/`.
Наконец, выполните команду
```
docker build . -t openmc_image
```

2.4 После завершения сборки в приложении во вкладке Images должен появиться образ с названием `openmc_image`. Напротив него будет кнопка запуска (треугольник, направленный вправо). Жмём.

2.5 Вылазит окно с настройками (первоначально секция настроек свёрнута. Разверните её). Идём по порядку.
- Container name - название для контейнера. Указывать не обязательно, но желательно, чтобы потом не потерять. ВНИМАНИЕ: При каждом создании контейнера имя должно быть новое, иначе вылетит ошибка
- Ports - порт, по которому вы будете открывать в своём браузере jupyter. Нужно указать обязательно. Лучше всего поставить значение 8888.
- Volumes - хранилища данных. Если не указать, то при каждом перезапуске контейнера, он будет пустой. В Host path указываем путь к ранее созданной пустой директории (в нашем случае это `<путь_к_директории>/openmc/jupyter`), а в Container path - `/home/jupyter`
- Enviroment variables - переменные окружения. Можно не задавать ничего. Будет полезно только в случае, если вы будете подключать свои библиотеки ядерных данных. Для этого загрузите свои библиотеки в рабочую директорию (`openmc/jupyter`) и укажите пути к файлам `cross_sections.xml` и `depletion_chains.xml`. Вот названия переменных и пример значений для скачанной библиотеки endfb7.1:
```
OPENMC_CHAIN_FILE = /home/jupyter/endfb-vii.1-hdf5/depletion_chains.xml
OPENMC_CROSS_SECTIONS = /home/jupyter/endfb-vii.1-hdf5/cross_sections.xml
```

2.6 После того, как вы задали все нужные параметры, запускаем контейнер (синяя кнопка `Run`). После этого в окне приложения полетит куча текста, из которого вам нужно извлечь ссылку типа `http://127.0.0.1:8888/lab?token=<много_букв_и_цифр>⁠`. Открывайте её в браузере.

2.7 Добро пожаловать в Jupyter Lab

## 3. Как тут работать
3.1 Слева находится меню и дерево проекта. В правой части вы увидите стартовое меню (лаунчер). Оно же будет открываться при создании новой вкладки (они расположены под адресной строкой). Для начала создайте новый блокнот python (самая первая опция). Это же (и ещё много чего полезного) можно сделать с помощью ПКМ в дереве проекта. 

3.2 В открывшемся jupyter-блокноте в первой же ячейке вставьте код:
```
import openmc
openmc.__version__
```
После этого запустите ячейку соответствующей кнопкой или сочетанием клавиш `Shift + Enter`. 

3.3 Если в результате под ячейкой вывелась версия (например, `'0.15.2'`), то всё работает. Можете исследовать и пользоваться!

## 4. Остановка и перезапуск контейнера
4.1 Перейдите на вкладку Containers  в Docker desktop. Здесь вы увидите список всех созданных контейнеров (или только один, если у вас всё вышло с первого раза). Справа от названия контейнера будет информация о нём и кнопки управления: запуск/установка, меню и удаление. Для остановки и/или пеезапуска контейнера достаточно нажать соответствующую конпку (никаких дополнительных действий не требуется) и немного подождать (или много, если компьютер очень слабый). Если на шаге 2.5 был корректно указан параметр Volumes, то при перезапуске всё, что находилось в рабочей директории сохранится
